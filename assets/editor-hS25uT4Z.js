const W=([t],[e])=>t===e?0:t<e?1:-1,P=(t,e)=>{const n=W(t,e);return n===0?t[1]===e[1]?0:t[1]<e[1]?1:-1:n},G=([t,e])=>P(t,e)===-1?[e,t]:[t,e],Ue=(t,e=n=>V(n)?n.text:"")=>t.reduce((n,s,r)=>(r!==0&&(n+=`
`),n+s.reduce((i,a)=>i+e(a),"")),""),Me=(t,e)=>t.split(`
`).map(n=>n?[{...e,text:n}]:[]);const Be=t=>t._type!==4;class H{constructor(e){this._ops=e?e.slice():[]}get ops(){return this._ops}insert(e,n){return this._ops.push({_type:2,_pos:e,_text:n}),this}insertFragment(e,n){return this._ops.push({_type:3,_pos:e,_fragment:n}),this}delete(e,n){return this._ops.push({_type:1,_start:e,_end:n}),this}select(e,n){return this._ops.push({_type:4,_anchor:e,_focus:n}),this}transform(e){return this._ops.reduce((n,s)=>Be(s)?ae(n,s):n,e)}}const We=(t,e)=>t.length===e.length&&t.every((n,s)=>n===e[s]),V=t=>"text"in t,{keys:we,is:$e}=Object,je=(t,e)=>{const n=we(t);return n.length!==we(e).length?!1:n.every(s=>s in e?s==="text"||$e(t[s],e[s]):!1)},Ye=t=>V(t)?t.text.length:1,Ze=t=>t.reduce((e,n)=>e+Ye(n),0),Je=(t,e=0,n=t.length-1)=>{let s=e+1;for(;s<=n;){const r=t[s-1],i=t[s];V(r)&&V(i)&&je(r,i)?(t[s-1]={...r,text:r.text+i.text},t.splice(s,1),n--):s++}},U=(...t)=>{const e=[];return t.forEach(n=>{if(n.length){const s=e.length;e.push(...n),s&&Je(e,s-1,s)}}),e},Y=(t,e)=>{for(let n=0;n<t.length;n++){const s=t[n],r=Ye(s);if(r>e){const i=t.slice(0,n),a=t.slice(n+1);if(V(s)){const l=s.text.slice(0,e),f=s.text.slice(e);l&&i.push({...s,text:l}),f&&a.unshift({...s,text:f})}else a.unshift(s);return[i,a]}e-=r}return[t,[]]},ie=(t,e,n,s)=>{const[r]=n,[i]=s||n,[a,l]=Y(t[n[0]],n[1]),f=s?Y(t[s[0]],s[1])[1]:l;if(typeof e=="string"){const _=a.length;e=Me(e,_?a[_-1]:void 0)}let d;e.length?(d=[...e],d[0]=U(a,d[0]),d[d.length-1]=U(d[d.length-1],f)):d=[U(a,f)];const u=t.slice();return u.splice(r,i-r+1,...d),u},Qe=(t,e,n)=>W(e,n)===0?[Y(Y(t[e[0]],n[1])[0],e[1])[1]]:[Y(t[e[0]],e[1])[1],...t.slice(e[0]+1,n[0]),Y(t[n[0]],n[1])[0]],et=t=>{switch(t._type){case 1:return P(t._start,t._end)===1;case 2:return!!t._text;case 3:return!!Ue(t._fragment)}return!0},tt=(t,e)=>{switch(e._type){case 1:return ie(t,[],e._start,e._end);case 2:return ie(t,e._text,e._pos);case 3:return ie(t,e._fragment,e._pos);default:return e}},ae=(t,e)=>{switch(e._type){case 1:{const{_start:n,_end:s}=e;if(P(t,n)!==1)return P(s,t)===1?[t[0]+n[0]-s[0],t[1]+(W(s,t)===0?n[1]-s[1]:0)]:n;break}case 2:case 3:{const n=e._pos,s=e._type===2?Me(e._text):e._fragment,r=s.length,i=r-1;if(P(t,n)!==1)return[t[0]+i,t[1]+(W(t,n)===0?Ze(s[r-1])-(i===0?0:n[1]):0)];break}}return t},nt=(t,e,n,s)=>{try{for(const r of n.ops)et(r)&&(Be(r)?(t=tt(t,r),e=[ae(e[0],r),ae(e[1],r)]):(r._anchor||r._focus)&&(e=[r._anchor||e[0],r._focus||e[1]]));return[t,e]}catch(r){s&&s("rollback transaction: "+r);return}},st=500,rt=500,ot=t=>{let e=0,n=0;const s=Date.now,r=[t],i=()=>r[e],a=()=>e>0,l=()=>e<r.length-1;return{get:i,set:f=>{r[e]=f},undo:()=>{if(a())return e--,i()},redo:()=>{if(l())return e++,i()},push:f=>{const d=s();e!==0&&d-n<rt&&e--,n=d,r[++e]=f,r.splice(e+1),e>st&&(e--,r.shift())}}};let x,p,D,$,le=!1,ue=!1,Ae;const it=1,ct=4,de=1,j=2,Z=3,Ee=4,at=5,lt=6,ut=1,ft=3,dt=8,Et=t=>t.nodeType===ft,J=t=>t.nodeType===ut,pt=t=>t.nodeType===dt,_t=new Set(["EMBED","IMG","PICTURE","AUDIO","VIDEO","SVG","CANVAS","MATH","IFRAME","OBJECT"]),Ke=t=>t.contentEditable==="false"||_t.has(t.tagName),fe=()=>p,He=()=>D===de?p.data.length:D===j?1:0,ht=t=>{x.currentNode=x.currentNode.parentNode.children[t]},Ie=t=>{const e=t.nextSibling;return!!e&&!pt(e)},Tt=()=>{for(;;){if(D===j){const t=p;for(;(p=x.nextNode())&&t.contains(p););}else p=x.nextNode();if(D=null,!p)break;if($){if($.contains(p)){if(le=!0,ue)break}else if(le)break}if(Et(p)){const t=p.data;if(t)return t===`
`?D=Ie(p)?Z:lt:D=de}else if(J(p)){if(p.tagName==="BR")return D=Ie(p)?Z:at;if(Ke(p))return D=j;if(Ae(p))return D=Ee}}},pe=(t,e,{_document:n,_isBlock:s},r)=>{try{return Ae=s,x=n.createTreeWalker(e,ct|it),r&&(r._startNode&&(x.currentNode=r._startNode,x.previousNode()),r._endNode&&($=r._endNode),ue=r._excludeEnd||!1),t(Tt)}finally{x=p=D=$=null,le=ue=!1}},gt=Math.min,Nt=typeof queueMicrotask=="function"?queueMicrotask:t=>{Promise.resolve().then(t)},vt=new Set(["DIV","H1","H2","H3","H4","H5","H6","P","PRE","LI","DT","DD","TR"]),yt=t=>vt.has(t.tagName),Dt=2,Ve=t=>t.ownerDocument,Fe=t=>Ve(t).getSelection(),St=(t,e)=>{if(t.rangeCount){const n=t.getRangeAt(0);if(e.contains(n.commonAncestorContainer))return n}},be=(t,e,n)=>{const s=Fe(t);s.removeAllRanges(),s.addRange(e),n&&(s.collapseToEnd(),s.extend(e.startContainer,e.startOffset))},Ce=(t,e,[n,s],r)=>{const i=P(n,s),a=i===0,l=i===-1,f=l?s:n,d=l?n:s;if(f[0]===0&&f[1]===0&&a&&!e.hasChildNodes()){const m=t.createRange();return m.setStart(e,0),m.setEnd(e,0),be(e,m),!0}const u=ke(e,f,r);if(!u)return!1;const _=a?u:ke(e,d,r);if(!_)return!1;const h=t.createRange(),[S,L]=u,[O,F]=_;return J(S)?L<1?h.setStartBefore(S):h.setStartAfter(S):h.setStart(S,L),J(O)?F<1?h.setEndBefore(O):h.setEndAfter(O):h.setEnd(O,F),be(e,h,l),!0},ke=(t,[e,n],s)=>pe(r=>{let i,a=!1;for(;i=r();)if(i===Ee)a||(a=!0,e!==0&&ht(e));else{const l=He();if(n<=l)return[fe(),n];n-=l}},t,s),Lt=(t,e)=>{let n=e;for(;;){const s=n.parentElement;if(s===t)break;n=s}return n},Ot=t=>{let e=0;for(;t=t.previousElementSibling;)e++;return e},Q=(t,e,n,s)=>{let r,i,a=!0;if(t===e&&!e.hasChildNodes())return[0,0];if(J(e)&&!Ke(e)&&e.hasChildNodes()){const f=gt(n,e.childNodes.length-1);e=e.childNodes[f],a=f===n,n=0}const l=Lt(t,e);return s._isBlock(l)?(r=l,i=Ot(r)):(r=t,i=0),pe(f=>{let d,u=0;for(;d=f();)d===Z?(i++,u=0):u+=He();return[i,u+n]},r,s,{_endNode:e,_excludeEnd:a})},Xe=(t,e,{startOffset:n,startContainer:s,endOffset:r,endContainer:i})=>{const a=Q(t,s,n,e);return[a,s===i&&n===r?a:Q(t,i,r,e)]},ze=()=>[[0,0],[0,0]],Rt=(t,e)=>t.compareDocumentPosition(e),xt=(t,e)=>{const n=Fe(t),s=St(n,t);if(!s)return ze();const r=Xe(t,e,s);return(n.anchorNode===n.focusNode?n.anchorOffset>n.focusOffset:(Rt(n.anchorNode,n.focusNode)&Dt)!==0)?[r[1],r[0]]:r},It=(t,e,n)=>pe(s=>{let r,i=null,a="",l=!1;const f=[],d=()=>{a&&(i||(i=[]),i.push({text:a}),a="")},u=()=>{d(),!i&&l&&(i=[]),i&&f.push(i),i=null,l=!1};for(;r=s();)if(r===Ee)u();else if(l=!0,r===de){const _=fe();a+=_.data}else if(r===j){d();const _=fe(),h=n(_);h&&i.push({data:h})}else r===Z&&u();return u(),f.length||f.push([]),f},t,e),Pt=(t,e,{clientX:n,clientY:s},r)=>{if(t.caretPositionFromPoint){const i=t.caretPositionFromPoint(n,s);if(i)return Q(e,i.offsetNode,i.offset,r)}else if(t.caretRangeFromPoint){const i=t.caretRangeFromPoint(n,s);if(i)return Q(e,i.startContainer,i.startOffset,r)}},mt=(t,e)=>{let n=!1;const s=[],r=l=>{n&&s.push(...l)},i=new MutationObserver(l=>{r(l),n||e()}),a=()=>{r(i.takeRecords())};return i.observe(t,{characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),{_record(l){!n&&l&&a(),n=l},_flush:()=>(a(),s.splice(0)),_dispose(){s.splice(0),i.disconnect()}}},wt=()=>({mount:t=>{t.ariaMultiLine=null},apply:(t,e)=>t(new H(e.ops.map(n=>n._type===2?{...n,_text:n._text.replaceAll(`
`,"")}:n._type===3?{...n,_fragment:[U(...n._fragment)]}:n)))}),ce=()=>{},bt=({schema:{single:t,js:e,doc:n,copy:s,paste:r},doc:i,isBlock:a=yt,onChange:l,onKeyDown:f,onError:d=console.error})=>{let u=ze(),_=!1,h=ce;const S=()=>L.get()[0],L=ot([n(i),u]),O=[];t&&O.push(wt());const F=O.reduceRight((o,{apply:T})=>T?(N,C,w)=>T(ne=>o(N,C,ne),w):o,(o,T,N)=>nt(o,T,N,d)),m=[],A=o=>{_||(m.unshift(o),qe(Ge))},ee=new Set,qe=o=>{ee.has(o)||(ee.add(o),Nt(()=>{ee.delete(o),o()}))},Ge=()=>{if(m.length){let o=S(),T=u,N;for(;N=m.pop();){const w=F(o,T,N);w&&(o=w[0],T=w[1])}const C=S();We(o,C)||(L.set([C,u]),L.push([o,T]),l(e(o))),u=T}},te={get doc(){return S()},get selection(){return u},input:o=>{if(!(window.InputEvent&&typeof InputEvent.prototype.getTargetRanges=="function"))return d("beforeinput event is not supported."),ce;const{contentEditable:T,role:N,ariaMultiLine:C,ariaReadOnly:w}=o,ne=o.style.whiteSpace;o.role="textbox",o.style.whiteSpace="pre-wrap",o.ariaMultiLine="true",O.forEach(({mount:c})=>{c&&c(o)});let _e=!1,se=!1,k=null,R=!1,X=!1,z=!1;const M=Ve(o),I={_document:M,_isBlock:a};h=()=>{o.contentEditable=_?"false":"true",o.ariaReadOnly=_?"true":null},h();const B=mt(o,()=>{X&&Ce(M,o,u,I)}),K=()=>{u=xt(o,I)},re=()=>{const c=B._flush();if(B._record(!1),c.length){let E;for(;E=c.pop();)if(E.type==="childList"){const{target:y,removedNodes:v,addedNodes:g,nextSibling:q}=E;for(let b=v.length-1;b>=0;b--)y.insertBefore(v[b],q);for(let b=g.length-1;b>=0;b--)y.removeChild(g[b])}else E.target.nodeValue=E.oldValue;B._flush(),se=Ce(M,o,u,I)}A(k),R=!1,k=null},he=c=>{if(!R){if(f&&f(c)){c.preventDefault();return}if((c.metaKey||c.ctrlKey)&&!c.altKey&&c.code==="KeyZ"&&(c.preventDefault(),B._record(!1),!_)){const E=c.shiftKey?L.redo():L.undo();E&&(l(e(E[0])),u=E[1])}}},Te=()=>{R||re()},ge=c=>{c.preventDefault();const E=c.inputType;if(E.startsWith("format")||E==="historyUndo"||E==="historyRedo")return;R?B._record(!0):K();const y=c.getTargetRanges()[0];if(y){const v=Xe(o,I,y);let g=E==="insertParagraph"||E==="insertLineBreak"?`
`:c.data;if(g==null){const q=c.dataTransfer;q&&(g=q.getData("text/plain"))}k||(k=new H().select(...u)),P(...v)!==0&&k.delete(...v),g&&k.insert(v[0],g)}R||re()},Ne=()=>{R||K(),R=!0},ve=()=>{re()},ye=()=>{X=!0,K()},De=()=>{X=!1},Se=()=>{if(se){se=!1;return}X&&!R&&!z&&K()},oe=c=>{K(),P(...u)!==0&&s(c,Qe(S(),...G(u)),o)},Le=c=>{c.preventDefault(),oe(c.clipboardData)},Oe=c=>{c.preventDefault(),_||(oe(c.clipboardData),A(new H().delete(...G(u))))},Re=c=>{c.preventDefault();const[E,y]=G(u);A(new H().delete(E,y).insertFragment(E,r(c.clipboardData,I)))},xe=c=>{c.preventDefault();const E=c.dataTransfer,y=Pt(M,o,c,I);if(E&&y){const v=new H;z&&v.delete(...G(u));const g=v.transform(y);v.select(g,g).insertFragment(g,r(E,I)).select(g),A(v),o.focus({preventScroll:!0})}},Pe=c=>{z=!0,oe(c.dataTransfer)},me=()=>{z=!1};return M.addEventListener("selectionchange",Se),o.addEventListener("keydown",he),o.addEventListener("input",Te),o.addEventListener("beforeinput",ge),o.addEventListener("compositionstart",Ne),o.addEventListener("compositionend",ve),o.addEventListener("focus",ye),o.addEventListener("blur",De),o.addEventListener("copy",Le),o.addEventListener("cut",Oe),o.addEventListener("paste",Re),o.addEventListener("drop",xe),o.addEventListener("dragstart",Pe),o.addEventListener("dragend",me),()=>{_e||(_e=!0,h=ce,o.contentEditable=T,o.role=N,o.ariaMultiLine=C,o.ariaReadOnly=w,o.style.whiteSpace=ne,B._dispose(),M.removeEventListener("selectionchange",Se),o.removeEventListener("keydown",he),o.removeEventListener("input",Te),o.removeEventListener("beforeinput",ge),o.removeEventListener("compositionstart",Ne),o.removeEventListener("compositionend",ve),o.removeEventListener("focus",ye),o.removeEventListener("blur",De),o.removeEventListener("copy",Le),o.removeEventListener("cut",Oe),o.removeEventListener("paste",Re),o.removeEventListener("drop",xe),o.removeEventListener("dragstart",Pe),o.removeEventListener("dragend",me))}},command:(o,...T)=>{const N=o.call(te,...T);return N&&A(N),te},readonly:o=>{_=o,h()}};return te};export{H as T,St as a,Fe as b,bt as c,Ue as d,V as e,Ze as g,pt as i,It as r,Me as s,G as t};
