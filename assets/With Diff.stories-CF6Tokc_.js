import{j as P}from"./jsx-runtime-D_zvdyIk.js";import{r as j}from"./iframe--__0NnYW.js";import{c as z}from"./editor-Dw_XHXbx.js";import{p as W}from"./plain-DXE80QuQ.js";class I{diff(e,n,t={}){let s;typeof t=="function"?(s=t,t={}):"callback"in t&&(s=t.callback);const l=this.castInput(e,t),c=this.castInput(n,t),i=this.removeEmpty(this.tokenize(l,t)),o=this.removeEmpty(this.tokenize(c,t));return this.diffWithOptionsObj(i,o,t,s)}diffWithOptionsObj(e,n,t,s){var l;const c=u=>{if(u=this.postProcess(u,t),s){setTimeout(function(){s(u)},0);return}else return u},i=n.length,o=e.length;let a=1,r=i+o;t.maxEditLength!=null&&(r=Math.min(r,t.maxEditLength));const f=(l=t.timeout)!==null&&l!==void 0?l:1/0,x=Date.now()+f,m=[{oldPos:-1,lastComponent:void 0}];let p=this.extractCommon(m[0],n,e,0,t);if(m[0].oldPos+1>=o&&p+1>=i)return c(this.buildValues(m[0].lastComponent,n,e));let g=-1/0,w=1/0;const L=()=>{for(let u=Math.max(g,-a);u<=Math.min(w,a);u+=2){let h;const C=m[u-1],v=m[u+1];C&&(m[u-1]=void 0);let b=!1;if(v){const E=v.oldPos-u;b=v&&0<=E&&E<i}const D=C&&C.oldPos+1<o;if(!b&&!D){m[u]=void 0;continue}if(!D||b&&C.oldPos<v.oldPos?h=this.addToPath(v,!0,!1,0,t):h=this.addToPath(C,!1,!0,1,t),p=this.extractCommon(h,n,e,u,t),h.oldPos+1>=o&&p+1>=i)return c(this.buildValues(h.lastComponent,n,e))||!0;m[u]=h,h.oldPos+1>=o&&(w=Math.min(w,u-1)),p+1>=i&&(g=Math.max(g,u+1))}a++};if(s)(function u(){setTimeout(function(){if(a>r||Date.now()>x)return s(void 0);L()||u()},0)})();else for(;a<=r&&Date.now()<=x;){const u=L();if(u)return u}}addToPath(e,n,t,s,l){const c=e.lastComponent;return c&&!l.oneChangePerToken&&c.added===n&&c.removed===t?{oldPos:e.oldPos+s,lastComponent:{count:c.count+1,added:n,removed:t,previousComponent:c.previousComponent}}:{oldPos:e.oldPos+s,lastComponent:{count:1,added:n,removed:t,previousComponent:c}}}extractCommon(e,n,t,s,l){const c=n.length,i=t.length;let o=e.oldPos,a=o-s,r=0;for(;a+1<c&&o+1<i&&this.equals(t[o+1],n[a+1],l);)a++,o++,r++,l.oneChangePerToken&&(e.lastComponent={count:1,previousComponent:e.lastComponent,added:!1,removed:!1});return r&&!l.oneChangePerToken&&(e.lastComponent={count:r,previousComponent:e.lastComponent,added:!1,removed:!1}),e.oldPos=o,a}equals(e,n,t){return t.comparator?t.comparator(e,n):e===n||!!t.ignoreCase&&e.toLowerCase()===n.toLowerCase()}removeEmpty(e){const n=[];for(let t=0;t<e.length;t++)e[t]&&n.push(e[t]);return n}castInput(e,n){return e}tokenize(e,n){return Array.from(e)}join(e){return e.join("")}postProcess(e,n){return e}get useLongestToken(){return!1}buildValues(e,n,t){const s=[];let l;for(;e;)s.push(e),l=e.previousComponent,delete e.previousComponent,e=l;s.reverse();const c=s.length;let i=0,o=0,a=0;for(;i<c;i++){const r=s[i];if(r.removed)r.value=this.join(t.slice(a,a+r.count)),a+=r.count;else{if(!r.added&&this.useLongestToken){let f=n.slice(o,o+r.count);f=f.map(function(x,m){const p=t[a+m];return p.length>x.length?p:x}),r.value=this.join(f)}else r.value=this.join(n.slice(o,o+r.count));o+=r.count,r.added||(a+=r.count)}}return s}}class A extends I{}const M=new A;function k(d,e,n){return M.diff(d,e,n)}class R extends I{constructor(){super(...arguments),this.tokenize=q}equals(e,n,t){return t.ignoreWhitespace?((!t.newlineIsToken||!e.includes(`
`))&&(e=e.trim()),(!t.newlineIsToken||!n.includes(`
`))&&(n=n.trim())):t.ignoreNewlineAtEof&&!t.newlineIsToken&&(e.endsWith(`
`)&&(e=e.slice(0,-1)),n.endsWith(`
`)&&(n=n.slice(0,-1))),super.equals(e,n,t)}}const V=new R;function _(d,e,n){return V.diff(d,e,n)}function q(d,e){e.stripTrailingCr&&(d=d.replace(/\r\n/g,`
`));const n=[],t=d.split(/(\n|\r\n)/);t[t.length-1]||t.pop();for(let s=0;s<t.length;s++){const l=t[s];s%2&&!e.newlineIsToken?n[n.length-1]+=l:n.push(l)}return n}const H={component:z},O="rgba(255, 0, 0, 0.2)",S="rgba(155, 185, 85, 0.2)",T=({type:d,children:e})=>P.jsx("span",{style:{background:d==="base"?O:S},children:e}),y=({result:d,type:e,value:n,onChange:t})=>{const s=j.useRef(null);return j.useEffect(()=>{if(s.current)return z({doc:n,schema:W({multiline:!0}),onChange:t}).input(s.current)},[]),P.jsx("div",{ref:s,style:{background:"white",padding:4,flex:1},children:n.split(`
`).map((l,c)=>{const i=d[c];return P.jsx("div",{style:i?{background:e==="base"?O:S}:void 0,children:l?Array.isArray(i)?i.map((o,a)=>!o.added&&!o.removed?o.value:e==="base"&&o.added||e==="target"&&o.removed?null:P.jsx(T,{type:e,children:o.value},a)):i?P.jsx(T,{type:e,children:l}):l:P.jsx("br",{})},c)})})},J={render:()=>{const[d,e]=j.useState(`This line is removed on the right.
just some text
abcd
efgh
Some more text
Some more text
Some more text`),[n,t]=j.useState(`just some text
abcz
zzzzefgh
Some more text.
This line is removed on the left.`),s=j.useMemo(()=>{const l=f=>(f.endsWith(`
`)?f.slice(0,-1):f).split(`
`),c=_(d,n);let i=0,o=0;const a={},r={};for(let f=0;f<c.length;f++){const{removed:x,added:m,value:p}=c[f],g=l(p);if(!x&&!m&&(i+=g.length,o+=g.length),x){const w=c[f+1];if(w&&w.added){const L=l(w.value),u=Math.max(g.length,L.length);for(let h=0;h<u;h++){const C=g[h],v=L[h];if(C!=null&&v!=null){const b=k(C,v);a[i]=b,r[o]=b}C!=null&&(a[i]||(a[i]=!0),i++),v!=null&&(r[o]||(r[o]=!0),o++)}f++;continue}for(const L of g)a[i]=!0,i++}if(m)for(const w of g)r[o]=!0,o++}return{base:a,target:r}},[d,n]);return P.jsxs("div",{style:{display:"flex",gap:4,width:"100vw"},children:[P.jsx(y,{type:"base",result:s.base,value:d,onChange:e}),P.jsx(y,{type:"target",result:s.target,value:n,onChange:t})]})}},K=["WithDiff"];export{J as WithDiff,K as __namedExportsOrder,H as default};
